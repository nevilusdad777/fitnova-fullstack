<div class="details-container">
    <!-- Header -->
    <div class="header">
        <div class="title-section">
            <h2>Personal Information</h2>
            <p>Manage your profile and personal details</p>
        </div>
        <div class="actions">
            <button class="btn-secondary" *ngIf="isEditing()" (click)="cancelEdit()" type="button">
                <lucide-icon [img]="X" [size]="18"></lucide-icon>
                <span>Cancel</span>
            </button>
            <button class="btn-primary" *ngIf="!isEditing()" (click)="toggleEdit()" type="button">
                <lucide-icon [img]="Edit2" [size]="18"></lucide-icon>
                <span>Edit Profile</span>
            </button>
            <button class="btn-primary" *ngIf="isEditing()" (click)="save()" [disabled]="detailsForm.invalid || isSaving()" type="button">
                <lucide-icon [img]="Save" [size]="18"></lucide-icon>
                <span>{{ isSaving() ? 'Saving...' : 'Save Changes' }}</span>
            </button>
        </div>
    </div>

    <!-- Profile Picture Section -->
    <div class="profile-section">
        <div class="profile-pic-container">
            <div class="profile-pic-wrapper">
                <img *ngIf="profilePicture()" [src]="profilePicture()" alt="Profile" class="profile-img">
                <div *ngIf="!profilePicture()" class="profile-placeholder">
                    <span>{{ detailsForm.get('fullName')?.value?.charAt(0) || 'U' }}</span>
                </div>
                <label *ngIf="isEditing()" class="upload-overlay" for="fileInput">
                    <lucide-icon [img]="Camera" [size]="32" color="white"></lucide-icon>
                    <span>Change Photo</span>
                </label>
                <input 
                    type="file" 
                    id="fileInput" 
                    accept="image/*" 
                    (change)="onFileSelected($event)" 
                    [disabled]="!isEditing()" 
                    hidden>
            </div>
            <button *ngIf="isEditing() && profilePicture()" class="btn-remove" (click)="removeProfilePicture()" type="button">
                Remove Photo
            </button>
        </div>
    </div>

    <!-- Form -->
    <form [formGroup]="detailsForm" class="details-form">
        <div class="form-section">
            <h3>Basic Information</h3>
            <div class="form-grid">
                <div class="form-group full-width">
                    <label for="fullName">Full Name *</label>
                    <input type="text" id="fullName" formControlName="fullName" placeholder="Enter your full name">
                    <span class="error" *ngIf="detailsForm.get('fullName')?.invalid && detailsForm.get('fullName')?.touched">
                        Name is required
                    </span>
                </div>

                <div class="form-group full-width">
                    <label for="email">Email Address</label>
                    <input type="email" id="email" formControlName="email" placeholder="your@email.com" readonly>
                    <span class="hint">Email cannot be changed</span>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3>Body Metrics</h3>
            <div class="form-grid">
                <div class="form-group">
                    <label for="age">Age *</label>
                    <input type="number" id="age" formControlName="age" placeholder="25" min="10" max="120">
                    <span class="error" *ngIf="detailsForm.get('age')?.invalid && detailsForm.get('age')?.touched">
                        Valid age required (10-120)
                    </span>
                </div>

                <div class="form-group">
                    <label for="gender">Gender *</label>
                    <select id="gender" formControlName="gender">
                        <option value="">Select gender</option>
                        <option value="male">Male</option>
                        <option value="female">Female</option>
                        <option value="other">Other</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="height">Height (cm) *</label>
                    <input type="number" id="height" formControlName="height" placeholder="170" min="50" max="300">
                    <span class="error" *ngIf="detailsForm.get('height')?.invalid && detailsForm.get('height')?.touched">
                        Valid height required (50-300 cm)
                    </span>
                </div>

                <div class="form-group">
                    <label for="weight">Weight (kg) *</label>
                    <input type="number" id="weight" formControlName="weight" placeholder="70" min="20" max="500">
                    <span class="error" *ngIf="detailsForm.get('weight')?.invalid && detailsForm.get('weight')?.touched">
                        Valid weight required (20-500 kg)
                    </span>
                </div>

                <div class="form-group full-width">
                    <label for="activityLevel">Activity Level *</label>
                    <select id="activityLevel" formControlName="activityLevel">
                        <option [value]="1.2">Sedentary (Little or no exercise)</option>
                        <option [value]="1.375">Lightly Active (1-3 days/week)</option>
                        <option [value]="1.55">Moderately Active (3-5 days/week)</option>
                        <option [value]="1.725">Very Active (6-7 days/week)</option>
                        <option [value]="1.9">Super Active (Physical job + exercise)</option>
                    </select>
                </div>
            </div>
        </div>
    </form>

    <!-- Crop Modal -->
    <div *ngIf="showCropModal()" class="crop-modal-overlay" (click)="closeCropModal()">
        <div class="crop-modal" (click)="$event.stopPropagation()">
            <div class="crop-header">
                <h3>Crop Profile Picture</h3>
                <button class="btn-close" (click)="closeCropModal()" type="button">
                    <lucide-icon [img]="X" [size]="24"></lucide-icon>
                </button>
            </div>
            <div class="crop-body">
                <p class="crop-hint">Drag the highlighted area to select the part you want to use</p>
                <div class="crop-canvas-wrapper">
                    <canvas 
                        #cropCanvas
                        (mousedown)="onCanvasMouseDown($event)"
                        (mousemove)="onCanvasMouseMove($event)"
                        (mouseup)="onCanvasMouseUp()"
                        (mouseleave)="onCanvasMouseUp()">
                    </canvas>
                </div>
            </div>
            <div class="crop-actions">
                <button class="btn-secondary" (click)="closeCropModal()" type="button">
                    Cancel
                </button>
                <button class="btn-primary" (click)="confirmCrop()" type="button">
                    <lucide-icon [img]="Crop" [size]="18"></lucide-icon>
                    <span>Crop & Use</span>
                </button>
            </div>
        </div>
    </div>
</div>